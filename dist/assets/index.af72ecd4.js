var t=Object.defineProperty,e=Object.prototype.hasOwnProperty,s=Object.getOwnPropertySymbols,i=Object.prototype.propertyIsEnumerable,a=(e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i,r=(t,r)=>{for(var o in r||(r={}))e.call(r,o)&&a(t,o,r[o]);if(s)for(var o of s(r))i.call(r,o)&&a(t,o,r[o]);return t};import{P as o,w as n,p as h}from"./vendor.ff13e120.js";!function(t=".",e="__import__"){try{self[e]=new Function("u","return import(u)")}catch(s){const i=new URL(t,location),a=t=>{URL.revokeObjectURL(t.src),t.remove()};self[e]=t=>new Promise(((s,r)=>{const o=new URL(t,i);if(self[e].moduleMap[o])return s(self[e].moduleMap[o]);const n=new Blob([`import * as m from '${o}';`,`${e}.moduleMap['${o}']=m;`],{type:"text/javascript"}),h=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(n),onerror(){r(new Error(`Failed to import: ${t}`)),a(h)},onload(){s(self[e].moduleMap[o]),a(h)}});document.head.appendChild(h)})),self[e].moduleMap={}}}("/assets/");class d extends o.Loader.File{constructor(t,e,s="google"){super(t,{type:"webfont",key:e.toString()}),this.fontNames=Array.isArray(e)?e:[e],this.service=s}load(){const t={active:()=>{this.loader.nextFile(this,!0)}};switch(this.service){case"google":t.google={families:this.fontNames};break;default:throw new Error("Unsupported font service")}n.load(t)}}class l extends o.Scene{constructor(){super("PreloaderScene")}preload(){this.initPreloader(),this.loadAssets()}initPreloader(){const{width:t,height:e}=this.cameras.main,s=this.add.graphics(),i=this.add.graphics();s.fillStyle(3223857,.8),s.fillRect(t/7,220,.75*t,40);const a=this.add.text(Number(t)/2,Number(e)/2-50,"Loading...",{fontFamily:'Consolas, "Courier New"',fontSize:"24px"});a.setOrigin(.5,.5);const r=this.add.text(Number(t)/2,Number(e)/2,"0%",{fontFamily:'Consolas, "Courier New"',fontSize:"18px"});r.setOrigin(.5,.5);const o=this.add.text(Number(t)/2,Number(e)/2+40,"",{fontFamily:'Consolas, "Courier New"',fontSize:"16px"});o.setOrigin(.5,.5),this.load.on("progress",(e=>{r.setText(`${(100*Number(e)).toFixed(2)}%`),i.clear(),i.fillStyle(16053493,.25),i.fillRect(t/6,227.5,Number(e)*t*.7,25)})),this.load.on("fileprogress",(t=>{o.setText("Loading asset: "+t.key)})),this.load.on("complete",(()=>{this.tweens.add({targets:[i,s,a,r,o],alpha:0,duration:350,onComplete:()=>{i.destroy(),s.destroy(),a.destroy(),r.destroy(),o.destroy(),this.scene.sendToBack(),this.scene.start("HomeScene")}})}))}loadAssets(){this.load.image("background","/bg-pattern.png"),this.load.spritesheet("terrain","/terrain.png",{frameWidth:16,frameHeight:16}),this.load.spritesheet("player","/player.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("player-run","/player-run.png",{frameWidth:32,frameHeight:32}),this.load.spritesheet("player-die","/fx/die.png",{frameWidth:96,frameHeight:96}),this.load.image("box-1","/box-1.png"),this.load.spritesheet("box-1-break","/fx/box-1-break.png",{frameWidth:24,frameHeight:24}),this.load.image("box-2","/box-2.png"),this.load.spritesheet("box-2-break","/fx/box-2-break.png",{frameWidth:24,frameHeight:24}),this.load.image("box-3","/box-3.png"),this.load.spritesheet("box-3-break","/fx/box-3-break.png",{frameWidth:24,frameHeight:24}),this.load.image("smoke","/fx/smoke.png"),this.load.image("home","/buttons/home.png"),this.load.image("home-pressed","/buttons/home-pressed.png"),this.load.image("restart","/buttons/restart.png"),this.load.image("restart-pressed","/buttons/restart-pressed.png"),this.load.image("play","/buttons/play.png"),this.load.image("play-pressed","/buttons/play-pressed.png"),this.load.image("volume-on","/buttons/volume-on.png"),this.load.image("volume-off","/buttons/volume-off.png"),this.load.audio("tick","/sfx/tick.wav"),this.load.audio("break","/sfx/break.wav"),this.load.audio("die","/sfx/die.wav"),this.load.audio("button","/sfx/button.wav"),this.load.audio("difficulty","/sfx/difficulty.wav"),this.load.addFile(new d(this.load,"Press Start 2P"))}}const u={fontFamily:'"Press Start 2P"'};class c extends o.Scene{constructor(){super("HomeScene")}create(){this.scene.bringToTop(),this.sfx=!0;const{width:t,height:e}=this.game.config;this.bgTexture=this.add.renderTexture(0,0,Number(t),Number(e)),this.bgTexture.fill(0,.6),this.titleText=this.add.text(Number(t)/2,.4*Number(e),"DROP.BOX",r(r({},u),{fontSize:"32px"})),this.titleText.setOrigin(.5,.5),this.titleText.setAlpha(0),this.playButton=this.add.image(Number(t)/2,.525*Number(e),"play"),this.playButton.setOrigin(.5,.5),this.playButton.setScale(2.25),this.playButton.setAlpha(0),this.sfxButton=this.add.image(Number(t)-24,Number(e)-24,"volume-on"),this.sfxButton.setScale(1.25),this.sfxButton.setAlpha(0),0===this.sound.volume&&(this.sfxButton.setTexture("volume-off"),this.sfx=!1),this.tweens.add({targets:[this.playButton,this.sfxButton,this.titleText],alpha:1,ease:"Sine.easeOut",duration:500,onComplete:()=>{this.initMenu()}}),this.scene.launch("GameScene")}initMenu(){this.playButton.setInteractive({cursor:"pointer"}),this.sfxButton.setInteractive({cursor:"pointer"}),this.sfxButton.on("pointerup",(()=>{this.toggleSfx()})),this.playButton.on("pointerdown",(()=>{this.playButton.setTexture("play-pressed")})),this.playButton.on("pointerup",(()=>{this.sound.play("button"),this.playButton.setTexture("play"),this.playButton.removeInteractive(),this.tweens.add({targets:[this.bgTexture,this.playButton,this.sfxButton,this.titleText],alpha:0,duration:350,onComplete:()=>{this.scene.sendToBack(),this.scene.get("GameScene").startGame()}})}))}toggleSfx(){this.sound.play("button"),this.sfx=!this.sfx,this.sfx?(this.sfxButton.setTexture("volume-on"),this.sound.volume=1):(this.sfxButton.setTexture("volume-off"),this.sound.volume=0)}}class p extends o.Physics.Arcade.Sprite{constructor(t,e,s){super(t,e,s,"player"),t.physics.world.enable(this),t.add.existing(this)}get isDead(){return this._isDead}static create(t){const{width:e,height:s}=t.game.config,i=new p(t,Number(e)/2,Number(s)-8);return i.setCollideWorldBounds(!0),i.initAnimations(),i.anims.play("chara-idle"),i}initAnimations(){this.anims.create({key:"chara-idle",frames:this.anims.generateFrameNumbers("player",{}),frameRate:24,repeat:-1}),this.anims.create({key:"chara-run",frames:this.anims.generateFrameNumbers("player-run",{}),frameRate:24,repeat:-1}),this.anims.create({key:"chara-dead",frames:this.anims.generateFrameNumbers("player-die",{}),frameRate:24,hideOnComplete:!0,repeat:3})}update(){if(this.isPointerDown){const{x:t}=this.scene.input.activePointer,{x:e}=this.body.position,s=e+this.displayWidth/2;Math.abs(t-s)<4?(this.idle(),"chara-idle"!==this.anims.getName()&&this.anims.play("chara-idle")):Number(t)>s?(this.walk(1),"chara-run"!==this.anims.getName()&&this.anims.play("chara-run")):Number(t)<s&&(this.walk(-1),"chara-run"!==this.anims.getName()&&this.anims.play("chara-run"))}else this.isLeftDown?this.walk(-1):this.isRightDown?this.walk(1):this.idle()}listenInputs(){const t=this.scene.input.keyboard.addKey(o.Input.Keyboard.KeyCodes.LEFT),e=this.scene.input.keyboard.addKey(o.Input.Keyboard.KeyCodes.RIGHT);this.scene.input.on("pointerdown",(()=>{this.isPointerDown=!0,this.anims.play("chara-run")})),this.scene.input.on("pointerup",(()=>{this.isPointerDown=!1,this.isLeftDown||this.isRightDown||this.anims.play("chara-idle")})),t.on("down",(()=>{this.isLeftDown=!0,this.anims.play("chara-run")})),t.on("up",(()=>{this.isLeftDown=!1,this.isPointerDown||this.isRightDown||this.anims.play("chara-idle")})),e.on("down",(()=>{this.isRightDown=!0,this.anims.play("chara-run")})),e.on("up",(()=>{this.isRightDown=!1,this.isPointerDown||this.isLeftDown||this.anims.play("chara-idle")}))}disableInputs(){this.isLeftDown=!1,this.isRightDown=!1,this.isPointerDown=!1,this.scene.input.keyboard.removeKey(o.Input.Keyboard.KeyCodes.LEFT),this.scene.input.keyboard.removeKey(o.Input.Keyboard.KeyCodes.RIGHT),this.scene.input.removeAllListeners("pointerup"),this.scene.input.removeAllListeners("pointerdown")}walk(t){this.body.enable&&(-1===t?(this.setVelocityX(-150),this.setFlipX(!0)):(this.setVelocityX(150),this.setFlipX(!1)))}idle(){this.body.enable&&this.setVelocityX(0)}revive(){this.body.enable=!0,this.setVisible(!0),this._isDead=!1;const{width:t,height:e}=this.scene.game.config;this.setPosition(Number(t)/2,Number(e)-8),this.setFlipX(!1),this.idle()}die(){this.body.enable=!1,this._isDead=!0,this.anims.stop(),this.anims.play("chara-dead")}setDieCallback(t){this.on("animationcomplete",t)}}const m=class extends o.Physics.Arcade.Image{constructor(t,e,s,i){super(t,e,s,`box-${i}`),t.physics.world.enable(this),t.add.existing(this),this.debrisManager=t.add.particles(`box-${i}-break`);this.debrisManager.createEmitter({frame:[0,1,2,3],quantity:8,gravityY:250,lifespan:{min:2e3,max:2250},bounce:{min:0,max:.35},maxParticles:8,alpha:{start:1,end:0},scale:{start:.75*m.SCALING[i],end:.75*m.SCALING[i]},on:!1}).setBounds(e,Number(this.scene.game.config.height)-this.displayHeight,16,this.displayHeight-8),this.smokeManager=t.add.particles("smoke"),this.smokeManager.createEmitter({on:!1,maxParticles:1,scale:{start:4*m.SCALING[i],end:4*m.SCALING[i]},alpha:{start:1,end:0},quantity:1,lifespan:2e3})}static createRandomBox(t,e=300){const s=Math.floor(3*Math.random())+1,{width:i}=t.game.config,a=new m(t,Math.random()*Number(i),-16*m.SCALING[s],s);return a.setOrigin(.5,.5),a.setCollideWorldBounds(!0),a.body.onWorldBounds=!0,a.handleWorldCollision(),a.setScale(m.SCALING[s],m.SCALING[s]),a.setGravityY(e*m.SCALING[s]),a}handleWorldCollision(){const{height:t}=this.scene.game.config;this.body.world.on("worldbounds",(()=>{if(!this.active)return;const{x:e,y:s}=this.body.position;Number(t)-(s+this.displayHeight)==8&&(this.debrisManager.emitParticleAt(e+this.displayWidth/2,s+.85*this.displayHeight),this.smokeManager.emitParticleAt(e+this.displayWidth/2,s+this.displayHeight/3),this.setVisible(!1),this.setActive(!1))}))}};let g=m;g.SCALING={1:1,2:1.33,3:1.67};class b{constructor(){this._isRunning=!1,this._score=0}get isRunning(){return this._isRunning}get score(){return this._score}set score(t){this._score=t}startGame(){this._isRunning=!0}stopGame(){this._isRunning=!1}incrementScore(){this.score=this.score+1}}class y{static getInstance(){return y.instance||(y.instance=new y),y.instance}get highScore(){return Number(localStorage.getItem("high-score"))||0}setHighScore(t){localStorage.setItem("high-score",t.toString())}}const f=class extends o.Scene{constructor(){super("GameScene")}create(){const{width:t,height:e}=this.game.config;this.state=this.initState(),this.bgTexture=this.add.tileSprite(0,0,Number(t),Number(e),"background").setOrigin(0,0),this.add.tileSprite(0,Number(e),Number(t),16,"terrain",2).setOrigin(0,.5),this.physics.world.setBounds(0,0,Number(t),Number(e)-8),this.boxes=this.add.group(),this.player=p.create(this),this.player.setDepth(1),this.player.setDieCallback((()=>{this.sound.play("die"),this.showResultScene()}));const s=y.getInstance().highScore;this.scoreText=this.add.text(16,16,`SCORE: ${this.state.score.toString().padStart(5,"0")}`,r(r({},u),{fontSize:"12px"})),this.highScoreText=this.add.text(Number(t)-16,16,`HI: ${s.toString().padStart(5,"0")}`,r(r({},u),{fontSize:"12px"})),this.highScoreText.setOrigin(1,0),this.spawnTime=0}startGame(){const{width:t,height:e}=this.game.config;this.difficulty=0;let s=3;const i=this.add.text(Number(t)/2,.45*Number(e),s.toString(),r(r({},u),{fontSize:"48px"})),a=this.add.text(Number(t)/2,.6*Number(e),"Use your mouse and keyboard to move your characters and avoid falling boxes!",r(r({},u),{fontSize:"12px",wordWrap:{width:225},align:"center"}));i.setOrigin(.5,.5),a.setOrigin(.5,.5),this.sound.play("tick");const o=this.time.addEvent({delay:1e3,loop:!0,callbackScope:this,callback:()=>{if(s--,isNaN(Number(i.text)))return i.destroy(),this.state.startGame(),this.setCollision(),this.player.listenInputs(),this.boxes.add(g.createRandomBox(this)),void o.destroy();s>0?i.setText(s.toString()):(i.setText("GO!"),a.destroy()),this.sound.play("tick")}})}setCollision(){this.physics.add.collider(this.player,this.boxes,(()=>{this.player.die(),this.player.disableInputs()}))}initState(){const t=new b;return new Proxy(t,{set:(t,e,s)=>(t[e]=s,"score"===e&&this.setScore(s),!0)})}update(t,e){if(this.bgTexture.tilePositionY+=.25,!this.state.isRunning)return;this.player.update(),this.boxes.children.each((t=>{t.active||(this.sound.play("break"),this.boxes.killAndHide(t),this.boxes.remove(t),this.player.isDead||this.state.incrementScore())}));let s="0";const i=Object.keys(f.spawnTime);for(let a=0;a<i.length&&this.state.score>=Number(i[a]);a++)s=i[a];Number(s)!==this.difficulty&&(this.sound.play("difficulty"),this.difficulty=Number(s)),this.spawnTime+=e,this.spawnTime>=f.spawnTime[s]&&(this.spawnTime=0,this.boxes.add(g.createRandomBox(this)))}setScore(t){this.scoreText.setText(`SCORE: ${t.toString().padStart(5,"0")}`)}showResultScene(){const t=y.getInstance(),e=t.highScore<this.state.score;e&&(this.highScoreText.setText(`HI: ${this.state.score.toString().padStart(5,"0")}`),t.setHighScore(this.state.score)),this.scene.launch("ResultScene",{state:this.state,isRecord:e})}restart(){this.cleanup(),this.startGame()}cleanup(){this.state=this.initState(),this.player.revive(),this.input.setDefaultCursor("default"),this.boxes.children.each((t=>{this.boxes.remove(t),t.setActive(!1),t.destroy()}))}};let x=f;x.spawnTime={0:750,25:500,50:250,100:100};class w extends o.Scene{constructor(){super("ResultScene")}init(t){this.state=t.state,this.isRecord=t.isRecord}create(){this.scene.bringToTop();const{width:t,height:e}=this.game.config,{score:s}=this.state;let i;this.bgTexture=this.add.renderTexture(0,0,Number(t),Number(e)),this.bgTexture.fill(0,.7),this.bgTexture.setAlpha(0),this.titleText=this.add.text(Number(t)/2,-100,"Game Over!",r(r({},u),{fontSize:"24px"})),this.scoreText=this.add.text(-100,3.75*Number(e)/10,`Your Score: ${s}`,r(r({},u),{fontSize:"14px"})),this.replayButton=this.add.image(Number(t)/2+32,Number(e)+100,"restart"),this.homeButton=this.add.image(Number(t)/2-32,Number(e)+100,"home"),this.replayButton.setScale(1.75),this.replayButton.setInteractive({cursor:"pointer"}),this.homeButton.setScale(1.75),this.homeButton.setInteractive({cursor:"pointer"}),this.titleText.setOrigin(.5),this.scoreText.setOrigin(.5),this.isRecord&&(i=this.add.text(Number(t)+100,.425*Number(e),"New Record!",r(r({},u),{fontSize:"10px"})),i.setOrigin(.5)),this.tweens.add({targets:this.bgTexture,alpha:1,duration:1e3,onComplete:()=>{this.tweens.add({targets:this.titleText,y:Number(e)/10*3,ease:"Power2",duration:1e3,onComplete:()=>{this.tweens.add({targets:this.scoreText,x:Number(t)/2,ease:"Power2",duration:1500}),i&&this.tweens.add({targets:i,x:.525*Number(t),ease:"Power2",duration:1500}),this.tweens.add({targets:this.replayButton,y:.525*Number(e),ease:"Power2",duration:1500,onComplete:()=>{this.restartGame()}}),this.tweens.add({targets:this.homeButton,y:.525*Number(e),ease:"Power2",duration:1500,onComplete:()=>{this.backToHome()}})}})}})}restartGame(){this.replayButton.setInteractive({cursor:"pointer"}),this.replayButton.on("pointerdown",(()=>{this.replayButton.setTexture("restart-pressed")})),this.replayButton.on("pointerup",(()=>{this.sound.play("button"),this.replayButton.setTexture("restart");const t=this.scene.get("GameScene");this.scene.setActive(!1),this.scene.setVisible(!1),this.scene.sendToBack(),this.input.disable(this.homeButton),this.input.disable(this.replayButton),t.restart()}))}backToHome(){this.homeButton.setInteractive({cursor:"pointer"}),this.homeButton.on("pointerdown",(()=>{this.homeButton.setTexture("home-pressed")})),this.homeButton.on("pointerup",(()=>{this.sound.play("button"),this.homeButton.setTexture("home"),this.scene.start("HomeScene")}))}}const S={type:h.AUTO,width:320,height:480,background:"transparent",physics:{default:"arcade",arcade:{gravity:{y:200}}},parent:"game",scene:[l,c,x,w]};new h.Game(S);
