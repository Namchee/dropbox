var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,s=Object.getOwnPropertySymbols,i=Object.prototype.propertyIsEnumerable,a=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,r=(e,r)=>{for(var o in r||(r={}))t.call(r,o)&&a(e,o,r[o]);if(s)for(var o of s(r))i.call(r,o)&&a(e,o,r[o]);return e};import{P as o,w as n,p as h}from"./vendor.ff13e120.js";!function(e=".",t="__import__"){try{self[t]=new Function("u","return import(u)")}catch(s){const i=new URL(e,location),a=e=>{URL.revokeObjectURL(e.src),e.remove()};self[t]=e=>new Promise(((s,r)=>{const o=new URL(e,i);if(self[t].moduleMap[o])return s(self[t].moduleMap[o]);const n=new Blob([`import * as m from '${o}';`,`${t}.moduleMap['${o}']=m;`],{type:"text/javascript"}),h=Object.assign(document.createElement("script"),{type:"module",src:URL.createObjectURL(n),onerror(){r(new Error(`Failed to import: ${e}`)),a(h)},onload(){s(self[t].moduleMap[o]),a(h)}});document.head.appendChild(h)})),self[t].moduleMap={}}}("/dropbox/assets/");class d extends o.Loader.File{constructor(e,t,s="google"){super(e,{type:"webfont",key:t.toString()}),this.fontNames=Array.isArray(t)?t:[t],this.service=s}load(){const e={active:()=>{this.loader.nextFile(this,!0)}};switch(this.service){case"google":e.google={families:this.fontNames};break;default:throw new Error("Unsupported font service")}n.load(e)}}const c={fontFamily:'"Press Start 2P"'};class l extends o.Scene{constructor(){super("HomeScene")}preload(){var e;(e=this).load.image("background","/dropbox/bg-pattern.png"),e.load.spritesheet("terrain","/dropbox/terrain.png",{frameWidth:16,frameHeight:16}),e.load.spritesheet("player","/dropbox/player.png",{frameWidth:32,frameHeight:32}),e.load.spritesheet("player-run","/dropbox/player-run.png",{frameWidth:32,frameHeight:32}),e.load.spritesheet("player-die","/dropbox/fx/die.png",{frameWidth:96,frameHeight:96}),e.load.image("box-1","/dropbox/box-1.png"),e.load.spritesheet("box-1-break","/dropbox/fx/box-1-break.png",{frameWidth:24,frameHeight:24}),e.load.image("box-2","/dropbox/box-2.png"),e.load.spritesheet("box-2-break","/dropbox/fx/box-2-break.png",{frameWidth:24,frameHeight:24}),e.load.image("box-3","/dropbox/box-3.png"),e.load.spritesheet("box-3-break","/dropbox/fx/box-3-break.png",{frameWidth:24,frameHeight:24}),e.load.image("smoke","/dropbox/fx/smoke.png"),e.load.image("restart","/dropbox/buttons/restart.png"),e.load.image("back","/dropbox/buttons/back.png"),e.load.image("play","/dropbox/buttons/play.png"),e.load.audio("tick","/dropbox/sfx/tick.wav"),e.load.audio("break","/dropbox/sfx/break.wav"),e.load.audio("die","/dropbox/sfx/die.wav"),e.load.audio("button","/dropbox/sfx/button.wav"),e.load.addFile(new d(e.load,"Press Start 2P"))}create(){this.scene.bringToTop();const{width:e,height:t}=this.game.config,s=this.add.renderTexture(0,0,Number(e),Number(t));s.fill(0,.6);const i=this.add.text(Number(e)/2,.4*Number(t),"DROP.BOX",r(r({},c),{fontSize:"32px"}));i.setOrigin(.5,.5),i.setAlpha(0);const a=this.add.image(Number(e)/2,.525*Number(t),"play");a.setOrigin(.5,.5),a.setScale(2.25),a.setAlpha(0),this.tweens.add({targets:[a,i],alpha:1,ease:"Sine.easeOut",duration:500,onComplete:()=>{a.setInteractive({cursor:"pointer"}),a.on("pointerup",(()=>{this.tweens.add({targets:[s,a,i],alpha:0,duration:250,onComplete:()=>{this.sound.play("button"),this.scene.sendToBack(),this.scene.get("GameScene").startGame()}})}))}}),this.scene.launch("GameScene")}}class p extends o.Physics.Arcade.Sprite{constructor(e,t,s){super(e,t,s,"player"),e.physics.world.enable(this),e.add.existing(this)}get isDead(){return this._isDead}static create(e){const{width:t,height:s}=e.game.config,i=new p(e,Number(t)/2,Number(s)-8);return i.setCollideWorldBounds(!0),i.initAnimations(),i.idle(),i}initAnimations(){this.anims.create({key:"chara-idle",frames:this.anims.generateFrameNumbers("player",{}),frameRate:24,repeat:-1}),this.anims.create({key:"chara-run",frames:this.anims.generateFrameNumbers("player-run",{}),frameRate:24,repeat:-1}),this.anims.create({key:"chara-dead",frames:this.anims.generateFrameNumbers("player-die",{}),frameRate:24,hideOnComplete:!0,repeat:3})}listenInputs(){const e=this.scene.input.keyboard.addKey(o.Input.Keyboard.KeyCodes.LEFT),t=this.scene.input.keyboard.addKey(o.Input.Keyboard.KeyCodes.RIGHT);e.on("down",(()=>{this.isLeftDown=!0,this.walk(-150,!0)})),e.on("up",(()=>{this.isLeftDown=!1,this.isRightDown?this.walk(150,!1):this.idle()})),t.on("down",(()=>{this.isRightDown=!0,this.walk(150,!1)})),t.on("up",(()=>{this.isRightDown=!1,this.isLeftDown?this.walk(-150,!0):this.idle()}))}disableInputs(){this.isLeftDown=!1,this.isRightDown=!1,this.scene.input.keyboard.removeKey(o.Input.Keyboard.KeyCodes.LEFT),this.scene.input.keyboard.removeKey(o.Input.Keyboard.KeyCodes.RIGHT)}walk(e,t){this.body.enable&&(this.setVelocityX(e),this.setFlipX(t),this.anims.play("chara-run"))}idle(){this.body.enable&&(this.setVelocityX(0),this.anims.play("chara-idle"))}revive(){this.body.enable=!0,this.setVisible(!0),this._isDead=!1;const{width:e,height:t}=this.scene.game.config;this.setPosition(Number(e)/2,Number(t)-8),this.setFlipX(!1),this.idle()}die(){this.body.enable=!1,this._isDead=!0,this.anims.stop(),this.anims.play("chara-dead")}setDieCallback(e){this.on("animationcomplete",e)}}const m=class extends o.Physics.Arcade.Image{constructor(e,t,s,i){super(e,t,s,`box-${i}`),e.physics.world.enable(this),e.add.existing(this),this.debrisManager=e.add.particles(`box-${i}-break`);this.debrisManager.createEmitter({frame:[0,1,2,3],quantity:8,gravityY:250,lifespan:2250,maxParticles:12,alpha:{start:1,end:0},scale:{start:.75*m.SCALING[i],end:.75*m.SCALING[i]},on:!1}).setBounds(t,Number(this.scene.game.config.height)-this.displayHeight,16,this.displayHeight-8),this.smokeManager=e.add.particles("smoke"),this.smokeManager.createEmitter({on:!1,maxParticles:1,scale:{start:4*m.SCALING[i],end:4*m.SCALING[i]},alpha:{start:1,end:0},quantity:1,lifespan:2e3})}static createRandomBox(e,t=250){const s=Math.floor(3*Math.random())+1,{width:i}=e.game.config,a=new m(e,Math.random()*Number(i),-16*m.SCALING[s],s);return a.setOrigin(.5,.5),a.setCollideWorldBounds(!0),a.body.onWorldBounds=!0,a.handleWorldCollision(),a.setScale(m.SCALING[s],m.SCALING[s]),a.setGravityY(t*m.SCALING[s]),a}handleWorldCollision(){const{height:e}=this.scene.game.config;this.body.world.on("worldbounds",(()=>{if(!this.active)return;const{x:t,y:s}=this.body.position;Number(e)-(s+this.displayHeight)==8&&(this.debrisManager.emitParticleAt(t+this.displayWidth/2,s+.8*this.displayHeight),this.smokeManager.emitParticleAt(t+this.displayWidth/2,s+this.displayHeight/3),this.setVisible(!1),this.setActive(!1))}))}};let u=m;u.SCALING={1:1,2:1.33,3:1.67};class b{constructor(){this._isRunning=!1,this._score=0}get isRunning(){return this._isRunning}get score(){return this._score}set score(e){this._score=e}startGame(){this._isRunning=!0}stopGame(){this._isRunning=!1}incrementScore(){this.score=this.score+1}}class g{static getInstance(){return g.instance||(g.instance=new g),g.instance}get highScore(){return Number(localStorage.getItem("high-score"))||0}setHighScore(e){localStorage.setItem("high-score",e.toString())}}const y=class extends o.Scene{constructor(){super("GameScene")}create(){const{width:e,height:t}=this.game.config;this.state=this.initState(),this.add.tileSprite(0,0,Number(e),Number(t),"background").setOrigin(0,0),this.add.tileSprite(0,Number(t),Number(e),16,"terrain",2).setOrigin(0,.5),this.physics.world.setBounds(0,0,Number(e),Number(t)-8),this.boxes=this.add.group(),this.player=p.create(this),this.player.setDepth(1),this.player.setDieCallback((()=>{this.sound.play("die"),this.showResultScene()}));const s=g.getInstance().highScore;this.scoreText=this.add.text(16,16,`SCORE: ${this.state.score.toString().padStart(5,"0")}`,r(r({},c),{fontSize:"12px"})),this.highScoreText=this.add.text(Number(e)-16,16,`HI: ${s.toString().padStart(5,"0")}`,r(r({},c),{fontSize:"12px"})),this.highScoreText.setOrigin(1,0),this.spawnTime=0}startGame(){const{width:e,height:t}=this.game.config;let s=3;const i=this.add.text(Number(e)/2,.45*Number(t),s.toString(),r(r({},c),{fontSize:"48px"})),a=this.add.text(Number(e)/2,.6*Number(t),"Use arrow keys to move your characters and avoid falling boxes!",r(r({},c),{fontSize:"12px",wordWrap:{width:225},align:"center"}));i.setOrigin(.5,.5),a.setOrigin(.5,.5),this.sound.play("tick");const o=this.time.addEvent({delay:1e3,loop:!0,callbackScope:this,callback:()=>{s--,isNaN(Number(i.text))&&(i.destroy(),this.state.startGame(),this.setCollision(),this.player.listenInputs(),o.destroy()),s>0?(this.sound.play("tick"),i.setText(s.toString())):(this.sound.play("tick"),i.setText("GO!"),a.destroy())}})}setCollision(){this.physics.add.collider(this.player,this.boxes,(()=>{this.player.die(),this.player.disableInputs()}))}initState(){const e=new b;return new Proxy(e,{set:(e,t,s)=>(e[t]=s,"score"===t&&this.setScore(s),!0)})}update(e,t){if(!this.state.isRunning)return;this.boxes.children.each((e=>{e.active||(this.sound.play("break"),this.boxes.killAndHide(e),this.boxes.remove(e),this.player.isDead||this.state.incrementScore())}));let s="0";const i=Object.keys(y.spawnTime);for(let a=0;a<i.length&&this.state.score>=y.spawnTime[i[a]];a++)s=i[a];this.spawnTime+=t,this.spawnTime>=y.spawnTime[s]&&(this.spawnTime=0,this.boxes.add(u.createRandomBox(this)))}setScore(e){this.scoreText.setText(`SCORE: ${e.toString().padStart(5,"0")}`)}showResultScene(){const e=g.getInstance(),t=e.highScore<this.state.score;t&&(this.highScoreText.setText(`HI: ${this.state.score.toString().padStart(5,"0")}`),e.setHighScore(this.state.score)),this.scene.launch("ResultScene",{state:this.state,isRecord:t})}restart(){this.cleanup(),this.startGame()}cleanup(){this.state=this.initState(),this.player.revive(),this.input.setDefaultCursor("default"),this.boxes.children.each((e=>{this.boxes.remove(e),e.setActive(!1),e.destroy()}))}};let x=y;x.spawnTime={0:850,25:600,50:250,100:100};class f extends o.Scene{constructor(){super("ResultScene")}init(e){this.state=e.state,this.isRecord=e.isRecord}create(){this.scene.bringToTop();const{width:e,height:t}=this.game.config,{score:s}=this.state,i=this.add.renderTexture(0,0,Number(e),Number(t));i.fill(0,.7),i.setAlpha(0);const a=this.add.text(Number(e)/2,-100,"Game Over!",r(r({},c),{fontSize:"24px"})),o=this.add.text(-100,3.75*Number(t)/10,`Your Score: ${s}`,r(r({},c),{fontSize:"14px"})),n=this.add.image(Number(e)/2+32,Number(t)+100,"restart"),h=this.add.image(Number(e)/2-32,Number(t)+100,"back");let d;n.setScale(1.75),n.setInteractive({cursor:"pointer"}),h.setScale(1.75),h.setInteractive({cursor:"pointer"}),a.setOrigin(.5),o.setOrigin(.5),this.isRecord&&(d=this.add.text(Number(e)+100,.425*Number(t),"New Record!",r(r({},c),{fontSize:"10px"})),d.setOrigin(.5)),this.tweens.add({targets:i,alpha:1,duration:1e3,onComplete:()=>{this.tweens.add({targets:a,y:Number(t)/10*3,ease:"Power2",duration:1e3,onComplete:()=>{this.tweens.add({targets:o,x:Number(e)/2,ease:"Power2",duration:1500}),d&&this.tweens.add({targets:d,x:.525*Number(e),ease:"Power2",duration:1500}),this.tweens.add({targets:n,y:.525*Number(t),ease:"Power2",duration:1500,onComplete:()=>{n.setInteractive({cursor:"pointer"}),n.on("pointerup",(()=>{const e=this.scene.get("GameScene");this.scene.setActive(!1),this.scene.setVisible(!1),this.scene.sendToBack(),this.input.disable(h),this.input.disable(n),e.restart()}))}}),this.tweens.add({targets:h,y:.525*Number(t),ease:"Power2",duration:1500,onComplete:()=>{h.setInteractive({cursor:"pointer"}),h.on("pointerup",(()=>{this.scene.start("HomeScene")}))}})}})}})}restart(){this.scene}}const w={type:h.AUTO,width:320,height:480,background:"transparent",physics:{default:"arcade",arcade:{gravity:{y:200}}},parent:"game",scene:[l,x,f]};new h.Game(w);
